<Page
    x:Class="Unison.UWPApp.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Unison.UWPApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:Unison.UWPApp.UI.Views"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    
    <Page.Resources>
    </Page.Resources>

    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="LayoutStates">
                <VisualState x:Name="WideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="720"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="Column0.Width" Value="320"/>
                        <Setter Target="Column1.Width" Value="*"/>
                        <Setter Target="ChatListPart.Visibility" Value="Visible"/>
                        <Setter Target="ChatDetailPart.Visibility" Value="Visible"/>
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="NarrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="Column0.Width" Value="*"/>
                        <Setter Target="Column0.MaxWidth" Value="9999"/>
                        <Setter Target="Column1.Width" Value="0"/>
                        <Setter Target="ChatDetailPart.Visibility" Value="Collapsed"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!-- Overlay (Visible when not logged in or during pairing) -->
        <Grid x:Name="MainOverlay" Visibility="Visible">
            <views:LoginView x:Name="LoginPart"/>
            
            <!-- Shims for legacy code references if any remain during transition -->
            <StackPanel Visibility="Collapsed">
                <Grid x:Name="LoginPanel"/><Grid x:Name="QRPairingPanel"/><Grid x:Name="ReconnectingPanel"/>
                <Grid x:Name="QRCodeBorder"/><Grid x:Name="QRPlaceholder"/><TextBlock x:Name="QRStatusText"/>
                <TextBlock x:Name="StatusDetail"/><TextBlock x:Name="StatusText"/>
                <Image x:Name="QRCodeImage"/><Grid x:Name="QRProgress"/>
                <Button x:Name="ReloadQRButton"/><Button x:Name="GenerateQRButton"/>
            </StackPanel>
        </Grid>

        <!-- Main Layout (Visible when logged in) -->
        <SplitView x:Name="RootSplitView" 
                   DisplayMode="CompactOverlay" 
                   CompactPaneLength="0"
                   IsPaneOpen="False" 
                   OpenPaneLength="260"
                   PaneBackground="{ThemeResource SystemControlBackgroundAltHighBrush}"
                   Visibility="Collapsed">
            <SplitView.Pane>
                <Grid Background="{ThemeResource SystemControlBackgroundAltHighBrush}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="Menu" Margin="20" FontSize="20" FontFamily="{StaticResource MainFontSemibold}"/>
                    
                    <ListView x:Name="NavListView" Grid.Row="1" SelectionMode="Single" SelectionChanged="NavListView_SelectionChanged">
                        <ListViewItem Tag="chats">
                            <StackPanel Orientation="Horizontal" Padding="12">
                                <TextBlock Text="&#xE8BD;" FontFamily="{StaticResource IconFont}" FontSize="18" VerticalAlignment="Center" Width="24"/>
                                <TextBlock Text="Chats" Margin="12,0,0,0" FontSize="14" FontFamily="{StaticResource MainFont}"/>
                            </StackPanel>
                        </ListViewItem>
                        <ListViewItem Tag="debug">
                            <StackPanel Orientation="Horizontal" Padding="12">
                                <TextBlock Text="&#xEBE8;" FontFamily="{StaticResource IconFont}" FontSize="18" VerticalAlignment="Center" Width="24" Foreground="{StaticResource UnisonGreenBrush}"/>
                                <TextBlock Text="Debug &amp; Logs" Margin="12,0,0,0" FontSize="14" FontFamily="{StaticResource MainFont}" Foreground="{StaticResource UnisonGreenBrush}"/>
                            </StackPanel>
                        </ListViewItem>
                    </ListView>
                </Grid>
            </SplitView.Pane>
            
            <SplitView.Content>
                <Grid x:Name="RootContentGrid">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="Column0" Width="320" MaxWidth="400"/>
                        <ColumnDefinition x:Name="Column1" Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left: Chat List -->
                    <views:ChatListView x:Name="ChatListPart" MenuClicked="ChatListPart_MenuClicked" ChatSelected="ChatListPart_ChatSelected"/>
                    
                    <!-- Right: Chat Detail -->
                    <views:ChatDetailView x:Name="ChatDetailPart" Grid.Column="1"/>

                    <!-- Full Screen Debug View -->
                    <views:DebugView x:Name="DebugPart" Grid.ColumnSpan="2" Visibility="Collapsed" BackRequested="DebugPart_BackRequested"/>
                </Grid>
            </SplitView.Content>
        </SplitView>
    </Grid>
</Page>
